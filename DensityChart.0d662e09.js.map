{"version":3,"sources":["components/VisualTools/Chart/DensityChart.js"],"names":["_react","_interopRequireWildcard","require","d3","_propTypes","_interopRequireDefault","_utils","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","DensityChart","props","startPosition","endPosition","self","useRef","svg","scales","x","scaleLinear","y","margin","useEffect","setTimeout","select","current","selectAll","remove","rect","getBoundingClientRect","innerWidth","width","innerHeight","height","append","attr","concat","domainExtentX","extent","data","d","fields","domainPaddingX","domainExtentY","domainPaddingY","domain","range","axisBottom","axisLeft","getCurrentMouseClickPosition","rec","node","event","sourceEvent","clientX","clientY","brush","on","startX","Math","min","startY","abs","selectedArea","selection","_ref","x0","y0","_ref2","max","x1","y1","filters","id","title","field","operation","values","numFixed","invert","filterAdded","end","layout","length","filterData","k","pow","round","log10","color","densityData","contourDensity","size","bandwidth","insert","enter","geoPath","value","createElement","ref","role","style","_default","exports","propTypes","PropTypes","arrayOf","shape","isRequired","string","number","currentCols","func"],"mappings":";AA2LC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA3LD,IAAAA,EAAAC,EAAAC,QAAA,UACAC,EAAAF,EAAAC,QAAA,OACAE,EAAAC,EAAAH,QAAA,eACAI,EAAAJ,QAAA,yBAAiD,SAAAG,EAAAE,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,GAAA,SAAAG,EAAAH,GAAAI,GAAAA,mBAAAA,QAAAC,OAAAA,KAAAA,IAAAA,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,QAAAD,OAAAA,EAAAA,SAAAH,GAAAA,OAAAA,EAAAM,EAAAD,IAAAL,GAAA,SAAAN,EAAAM,EAAAK,GAAAA,IAAAA,GAAAL,GAAAA,EAAAC,WAAAD,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAE,MAAAA,CAAAA,QAAAF,GAAAM,IAAAA,EAAAH,EAAAE,GAAAC,GAAAA,GAAAA,EAAAC,IAAAP,GAAAM,OAAAA,EAAAE,IAAAR,GAAAS,IAAAA,EAAAC,CAAAA,UAAAC,MAAAA,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAAC,IAAAA,IAAAA,KAAAf,EAAAe,GAAAA,YAAAA,GAAAC,GAAAA,eAAAC,KAAAjB,EAAAe,GAAAG,CAAAA,IAAAA,EAAAP,EAAAC,OAAAE,yBAAAd,EAAAe,GAAAG,KAAAA,IAAAA,EAAAV,KAAAU,EAAAC,KAAAP,OAAAC,eAAAJ,EAAAM,EAAAG,GAAAT,EAAAM,GAAAf,EAAAe,GAAAN,OAAAA,EAAAP,QAAAF,EAAAM,GAAAA,EAAAa,IAAAnB,EAAAS,GAAAA,EAEjD,SAASW,EAAaC,GACpB,IAAIC,EAAgB,CAAC,EAAG,GACpBC,EAAc,CAAC,EAAG,GAChBC,GAAO,EAAAC,EAAM,UACbC,GAAM,EAAAD,EAAM,UACZE,GAAS,EAAAF,EAAM,QAAC,CACpBG,EAAGhC,EAAGiC,cACNC,EAAGlC,EAAGiC,gBAEFE,EACC,GADDA,EAEG,GAFHA,EAGI,GAHJA,EAIE,GAuJR,OA3HA,EAAAC,EAAS,WAAC,WACRC,WAAW,WACTrC,EAAGsC,OAAOV,EAAKW,SAASC,UAAU,OAAOC,OAAO,OAChD,IAAMC,EAAOd,EAAKW,QAAQI,wBACpBC,EAAaF,EAAKG,MAAQV,EAAcA,EACxCW,EAAcJ,EAAKK,OAASZ,EAAaA,EAE/CL,EAAIS,QAAUvC,EACXsC,OAAOV,EAAKW,SACZS,OAAO,OACPC,KAAK,QAASP,EAAKG,OACnBI,KAAK,SAAUP,EAAKK,QACpBC,OAAO,KACPC,KAAK,YAAWC,aAAAA,OAAef,EAAWe,KAAAA,OAAIf,EAAa,MAC9D,IACMgB,EAAgBnD,EAAGoD,OAAO3B,EAAM4B,KAAM,SAACC,GAAC,OAAKA,EAAE7B,EAAM8B,OAAOvB,KAC5DwB,EAFiB,IAECL,EAAc,GAAKA,EAAc,IACnDM,EAAgBzD,EAAGoD,OAAO3B,EAAM4B,KAAM,SAACC,GAAC,OAAKA,EAAE7B,EAAM8B,OAAOrB,KAC5DwB,EAJiB,IAICD,EAAc,GAAKA,EAAc,IACzD1B,EAAOQ,QAAQP,EACZ2B,OAAO,CAACR,EAAc,GAAKK,EAC1BL,EAAc,GAAKK,IACpBI,MAAM,CAAC,EAAGhB,IAEbb,EAAOQ,QAAQL,EACZyB,OAAO,CAACF,EAAc,GAAKC,EAC1BD,EAAc,GAAKC,IACpBE,MAAM,CAACd,EAAa,IAEvBhB,EAAIS,QACDS,OAAO,KACPC,KAAK,YAAWC,eAAAA,OAAiBJ,EAAc,MAC/CzB,KAAKrB,EAAG6D,WAAW9B,EAAOQ,QAAQP,IACrCF,EAAIS,QAAQS,OAAO,KAAK3B,KAAKrB,EAAG8D,SAAS/B,EAAOQ,QAAQL,IAExD,IAAM6B,EAA+B,WACnC,IAAMC,EAAMlC,EAAIS,QAAQD,OAAO,YAAY2B,OAG3C,MAAO,CAFQjE,EAAGkE,MAAMC,YAAYC,QAAUJ,EAAIrB,wBAAwBX,EAC3DhC,EAAGkE,MAAMC,YAAYE,QAAUL,EAAIrB,wBAAwBT,IAItEoC,EAAQtE,EACXsE,QACAlB,OAAO,CACN,CAAC,EAAG,GACJ,CAACR,EAAYE,KACZyB,GAAG,QAAS,WACb7C,EAAgBqC,IAChBjC,EAAIS,QAAQC,UAAU,cAAcC,OAAO,UAC1C8B,GAAG,QAAS,WACb5C,EAAcoC,IACdjC,EAAIS,QAAQC,UAAU,kBAAkBC,OAAO,kBAC/CX,EAAIS,QAAQC,UAAU,cAAcC,OAAO,QAC3C,IAAM+B,EAASC,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,IAChDgD,EAASF,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,IACnCG,EAAIS,QAAQS,OAAO,QACnCC,KAAK,QAAS,iBACdA,KAAK,WAAY,YACjBA,KAAK,IAAKuB,GACVvB,KAAK,IAAK0B,GACV1B,KAAK,QAASwB,KAAKG,IAAIjD,EAAY,GAAKD,EAAc,KACtDuB,KAAK,SAAUwB,KAAKG,IAAIjD,EAAY,GAAKD,EAAc,KACvDuB,KAAK,OAAQ,8BAEjBsB,GAAG,MAAO,WACT5C,EAAcoC,IACdjC,EAAIS,QAAQC,UAAU,kBAAkBC,OAAO,kBAC/CX,EAAIS,QAAQC,UAAU,cAAcC,OAAO,QAC3C,IAAM+B,EAASC,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,IAChDgD,EAASF,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,IAChDkD,EAAe/C,EAAIS,QAAQS,OAAO,QACrCC,KAAK,QAAS,iBACdA,KAAK,WAAY,YACjBA,KAAK,IAAKuB,GACVvB,KAAK,IAAK0B,GACV1B,KAAK,QAASwB,KAAKG,IAAIjD,EAAY,GAAKD,EAAc,KACtDuB,KAAK,SAAUwB,KAAKG,IAAIjD,EAAY,GAAKD,EAAc,KACvDuB,KAAK,OAAQ,6BAvGZ,WACV,GAAKjD,EAAGkE,MAAMY,UAAd,CACA,IAAAC,EAAiB,CAACN,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,IACvD8C,KAAKC,IAAIhD,EAAc,GAAIC,EAAY,KADlCqD,EAAED,EAAA,GAAEE,EAAEF,EAAA,GAEbG,EAAiB,CAACT,KAAKU,IAAIzD,EAAc,GAAIC,EAAY,IACvD8C,KAAKU,IAAIzD,EAAc,GAAIC,EAAY,KADlCyD,EAAEF,EAAA,GAAEG,EAAEH,EAAA,GAEPI,EAAU,CACd,CACEC,GAAErC,GAAAA,OAAKzB,EAAM8D,GAAM,MACnBC,MAAO/D,EAAM+D,MACbC,MAAOhE,EAAM8B,OAAOvB,EACpB0D,UAAW,QACXC,OAAQ,EAAC,EAAAC,EAAQ,UAAC7D,EAAOQ,QAAQP,EAAE6D,OAAOb,KAAM,EAAAY,EAAQ,UAAC7D,EAAOQ,QAAQP,EAAE6D,OAAOT,MAEnF,CACEG,GAAErC,GAAAA,OAAKzB,EAAM8D,GAAM,MACnBC,MAAO/D,EAAM+D,MACbC,MAAOhE,EAAM8B,OAAOrB,EACpBwD,UAAW,QACXC,OAAQ,EAAC,EAAAC,EAAQ,UAAC7D,EAAOQ,QAAQL,EAAE2D,OAAOR,KAAM,EAAAO,EAAQ,UAAC7D,EAAOQ,QAAQL,EAAE2D,OAAOZ,OAGrFxD,EAAMqE,YAAYR,IAkFZS,GACA1D,WACE,WACEwC,EAAapC,UAEf,MAINX,EAAIS,QAAQS,OAAO,KAAK3B,KAAKiD,IAC5B,MACF,CAAC7C,EAAMuE,UAEV,EAAA5D,EAAS,WAAC,WACRC,WAAW,WACT,IAAMK,EAAOd,EAAKW,QAAQI,wBACpBC,EAAaF,EAAKG,MAAQV,EAAcA,EACxCW,EAAcJ,EAAKK,OAASZ,EAAaA,EAEzCkB,EAAS5B,EAAT4B,KACuB,IAAzB5B,EAAM6D,QAAQW,SAAc5C,EAAO5B,EAAMyE,YAE7C,IAAMC,EAAC1B,KAAA2B,IAAG,IAAQ,EAAI3B,KAAK4B,MAAM5B,KAAK6B,MAAMjD,EAAK4C,UAC3CM,EAAQvG,EAAGiC,cAAc0B,OAAO,CAAC,EAAGwC,IAAIvC,MAAM,CAAC,QAAS,YAExD4C,EAAcxG,EACjByG,iBACAzE,EAAE,SAACsB,GAAC,OAAKvB,EAAOQ,QAAQP,EAAEsB,EAAE7B,EAAM8B,OAAOvB,MACzCE,EAAE,SAACoB,GAAC,OAAKvB,EAAOQ,QAAQL,EAAEoB,EAAE7B,EAAM8B,OAAOrB,MACzCwE,KAAK,CAAC9D,EAAYE,IAClB6D,UAAU,GALO3G,CAKHqD,GAEjBvB,EAAIS,QAAQD,OAAO,cAAcG,OAAO,KACxCX,EAAIS,QACDqE,OAAO,IAAK,KACZ3D,KAAK,KAAM,aACXT,UAAU,QACVa,KAAKmD,GACLK,QACA7D,OAAO,QACPC,KAAK,IAAKjD,EAAG8G,WACb7D,KAAK,OAAQ,SAACK,GAAC,OAAKiD,EAAMjD,EAAEyD,UAC9B,MACF,CAACtF,EAAMuE,OAAQvE,EAAM6D,QAAS7D,EAAMyE,aAChCrG,EAAAS,QAAA0G,cAAA,MAAA,CAAKzB,GAAI9D,EAAM8D,GAAI0B,IAAKrF,EAAMsF,KAAK,SAASC,MAAO,CAAEtE,MAAO,OAAQE,OAAQ,UACpF,IAAAqE,EAAAC,QAAA/G,QAEckB,EAEfA,EAAa8F,UAAY,CACvBjE,KAAMkE,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WAC7CnE,OAAQgE,EAAS,QAACE,MAAM,CAAEzF,EAAGuF,EAAS,QAACI,OAAOD,WAAYxF,EAAGqF,EAAS,QAACI,OAAOD,aAC3EA,WACHnC,GAAIgC,EAAS,QAACI,OAAOD,WACrBxB,WAAYqB,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WACnDpC,QAASiC,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WAChD1B,OAAQuB,EAAS,QAACE,MAAM,CACtB5E,MAAO0E,EAAS,QAACK,OAAOF,WACxBG,YAAaN,EAAS,QAACK,OAAOF,aAC7BA,WACH5B,YAAayB,EAAS,QAACO,KAAKJ,WAC5BlC,MAAO+B,EAAS,QAACI,OAAOD","file":"DensityChart.0d662e09.js","sourceRoot":"../source","sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport { numFixed } from '../../../common/utils';\n\nfunction DensityChart(props) {\n  let startPosition = [0, 0];\n  let endPosition = [0, 0];\n  const self = useRef();\n  const svg = useRef();\n  const scales = useRef({\n    x: d3.scaleLinear(),\n    y: d3.scaleLinear(),\n  });\n  const margin = {\n    top: 10,\n    right: 30,\n    bottom: 20,\n    left: 40,\n  };\n\n  const end = () => {\n    if (!d3.event.selection) return;\n    const [x0, y0] = [Math.min(startPosition[0], endPosition[0]),\n      Math.min(startPosition[1], endPosition[1])];\n    const [x1, y1] = [Math.max(startPosition[0], endPosition[0]),\n      Math.max(startPosition[1], endPosition[1])];\n    const filters = [\n      {\n        id: `${props.id}_x`,\n        title: props.title,\n        field: props.fields.x,\n        operation: 'range',\n        values: [numFixed(scales.current.x.invert(x0)), numFixed(scales.current.x.invert(x1))],\n      },\n      {\n        id: `${props.id}_y`,\n        title: props.title,\n        field: props.fields.y,\n        operation: 'range',\n        values: [numFixed(scales.current.y.invert(y1)), numFixed(scales.current.y.invert(y0))],\n      },\n    ];\n    props.filterAdded(filters);\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      d3.select(self.current).selectAll('svg').remove('svg');\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n\n      svg.current = d3\n        .select(self.current)\n        .append('svg')\n        .attr('width', rect.width)\n        .attr('height', rect.height)\n        .append('g')\n        .attr('transform', `translate(${margin.left},${margin.top})`);\n      const paddingPercent = 0.1; // Adjust the percentage of padding as needed\n      const domainExtentX = d3.extent(props.data, (d) => d[props.fields.x]);\n      const domainPaddingX = (domainExtentX[1] - domainExtentX[0]) * paddingPercent;\n      const domainExtentY = d3.extent(props.data, (d) => d[props.fields.y]);\n      const domainPaddingY = (domainExtentY[1] - domainExtentY[0]) * paddingPercent;\n      scales.current.x\n        .domain([domainExtentX[0] - domainPaddingX,\n          domainExtentX[1] + domainPaddingX])\n        .range([0, innerWidth]);\n\n      scales.current.y\n        .domain([domainExtentY[0] - domainPaddingY,\n          domainExtentY[1] + domainPaddingY])\n        .range([innerHeight, 0]);\n\n      svg.current\n        .append('g')\n        .attr('transform', `translate(0,${innerHeight})`)\n        .call(d3.axisBottom(scales.current.x));\n      svg.current.append('g').call(d3.axisLeft(scales.current.y));\n\n      const getCurrentMouseClickPosition = () => {\n        const rec = svg.current.select('.overlay').node();\n        const mouseX = d3.event.sourceEvent.clientX - rec.getBoundingClientRect().x;\n        const mouseY = d3.event.sourceEvent.clientY - rec.getBoundingClientRect().y;\n        return [mouseX, mouseY];\n      };\n\n      const brush = d3\n        .brush()\n        .extent([\n          [0, 0],\n          [innerWidth, innerHeight],\n        ]).on('start', () => {\n          startPosition = getCurrentMouseClickPosition();\n          svg.current.selectAll('.selection').remove('rect');\n        }).on('brush', () => {\n          endPosition = getCurrentMouseClickPosition();\n          svg.current.selectAll('.selected-area').remove('.selected-area');\n          svg.current.selectAll('.selection').remove('rect');\n          const startX = Math.min(startPosition[0], endPosition[0]);\n          const startY = Math.min(startPosition[1], endPosition[1]);\n          const selectArea = svg.current.append('rect')\n            .attr('class', 'selected-area')\n            .attr('position', 'absolute')\n            .attr('x', startX)\n            .attr('y', startY)\n            .attr('width', Math.abs(endPosition[0] - startPosition[0]))\n            .attr('height', Math.abs(endPosition[1] - startPosition[1]))\n            .attr('fill', 'rgba(130, 130, 130, 0.5)');\n        })\n        .on('end', () => {\n          endPosition = getCurrentMouseClickPosition();\n          svg.current.selectAll('.selected-area').remove('.selected-area');\n          svg.current.selectAll('.selection').remove('rect');\n          const startX = Math.min(startPosition[0], endPosition[0]);\n          const startY = Math.min(startPosition[1], endPosition[1]);\n          const selectedArea = svg.current.append('rect')\n            .attr('class', 'selected-area')\n            .attr('position', 'absolute')\n            .attr('x', startX)\n            .attr('y', startY)\n            .attr('width', Math.abs(endPosition[0] - startPosition[0]))\n            .attr('height', Math.abs(endPosition[1] - startPosition[1]))\n            .attr('fill', 'rgba(140, 140, 140, 0.5)');\n          end();\n          setTimeout(\n            () => {\n              selectedArea.remove();\n            },\n            20,\n          );\n        });\n\n      svg.current.append('g').call(brush);\n    }, 100);\n  }, [props.layout]);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n\n      let { data } = props;\n      if (props.filters.length !== 0) data = props.filterData;\n\n      const k = 10 ** (-4 + Math.round(Math.log10(data.length)));\n      const color = d3.scaleLinear().domain([0, k]).range(['white', '#4682b4']);\n\n      const densityData = d3\n        .contourDensity()\n        .x((d) => scales.current.x(d[props.fields.x]))\n        .y((d) => scales.current.y(d[props.fields.y]))\n        .size([innerWidth, innerHeight])\n        .bandwidth(20)(data);\n\n      svg.current.select('#draw_area').remove('g');\n      svg.current\n        .insert('g', 'g')\n        .attr('id', 'draw_area')\n        .selectAll('path')\n        .data(densityData)\n        .enter()\n        .append('path')\n        .attr('d', d3.geoPath())\n        .attr('fill', (d) => color(d.value));\n    }, 100);\n  }, [props.layout, props.filters, props.filterData]);\n  return <div id={props.id} ref={self} role=\"figure\" style={{ width: '100%', height: '100%' }} />;\n}\n\nexport default DensityChart;\n\nDensityChart.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  fields: PropTypes.shape({ x: PropTypes.string.isRequired, y: PropTypes.string.isRequired })\n    .isRequired,\n  id: PropTypes.string.isRequired,\n  filterData: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filters: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  layout: PropTypes.shape({\n    width: PropTypes.number.isRequired,\n    currentCols: PropTypes.number.isRequired,\n  }).isRequired,\n  filterAdded: PropTypes.func.isRequired,\n  title: PropTypes.string.isRequired,\n};\n"]}