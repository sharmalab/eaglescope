{"version":3,"sources":["components/VisualTools/Chart/HorizontalBarChart.js"],"names":["_react","_interopRequireWildcard","require","d3","_propTypes","_interopRequireDefault","_tooltip","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","transformList","data","f","map","Map","forEach","d","items","Array","isArray","from","key","value","transform","field","isList","arguments","length","undefined","nest","sortKeys","ascending","rollup","v","entries","HorizontalBarChart","props","margin","top","right","bottom","left","fields","y","x","fullData","self","useRef","scaleRef","hightRef","viewerRef","createXScale","width","xScale","scaleLinear","domain","max","range","createYScale","height","yScale","scaleBand","padding","createTextLabel","current","selectAll","remove","enter","append","attr","bandwidth","text","on","filter","id","title","operation","values","filterAdded","drawBar","selection","className","addLabel","concat","offset","tooltipHandlers","createTooltip","updateBars","enterBars","mousemove","mouseleave","enterData","_props$fields","selected","merge","transition","duration","exit","useEffect","setTimeout","select","rect","getBoundingClientRect","innerWidth","innerHeight","svg","axisBottom","tickSize","layout","filters","filterData","createElement","ref","style","_default","exports","propTypes","PropTypes","arrayOf","shape","isRequired","string","bool","func","number","currentCols"],"mappings":"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","file":"HorizontalBarChart.4f020c9a.js","sourceRoot":"../source","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport createTooltip from '../../partials/tooltip';\n\nconst transformList = (data, f) => {\n  const map = new Map();\n  data.forEach((d) => {\n    const items = d[f];\n    if (Array.isArray(items)) {\n      items.forEach((i) => {\n        if (!map.has(i)) { map.set(i, 0); }\n        map.set(i, map.get(i) + 1);\n      });\n    } else {\n      if (!map.has(items)) { map.set(items, 0); }\n      map.set(items, map.get(items) + 1);\n    }\n  });\n  return Array.from(map).map((d) => ({ key: d[0], value: d[1] }));\n};\n\nconst transform = (data, field, isList = false) => {\n  if (isList) {\n    return transformList(data, field);\n  }\n  return d3\n    .nest()\n    .key((d) => d[field])\n    .sortKeys(d3.ascending)\n    .rollup((v) => v.length)\n    .entries(data);\n};\n\nfunction HorizontalBarChart(props) {\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 10,\n  };\n\n  const fields = { y: 'key', x: 'value' };\n  const fullData = transform(props.data, props.fields.y, props.fields.isList);\n  const self = useRef();\n  const scaleRef = useRef();\n  const hightRef = useRef();\n  const viewerRef = useRef();\n\n  const createXScale = (f, width) => {\n    const xScale = d3\n      .scaleLinear()\n      .domain([0, d3.max(fullData, (d) => d[f])])\n      .range([0, width]);\n    return xScale;\n  };\n\n  const createYScale = (f, height) => {\n    // set the ranges\n    const yScale = d3\n      .scaleBand()\n      .domain(fullData.map((d) => d[f]))\n      .range([height, 0])\n      .padding(0.1);\n    return yScale;\n  };\n\n  const createTextLabel = () => {\n    viewerRef.current.selectAll('.label').remove();\n    viewerRef.current\n      .selectAll('.label')\n      .data(fullData, (d) => d[fields.y])\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', 5)\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]) + scaleRef.current.y.bandwidth() / 2 + 4)\n      .text((d) => d.key)\n      .on('click', x=>{\n        const filter = {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: x.key,\n        };\n        props.filterAdded([filter])\n      });\n  };\n\n  const drawBar = (selection, data, className = 'og') => {\n    const addLabel = (d) => `${d.key}: ${d.value}`;\n    const offset = {\n      x: 30,\n      y: 10,\n    };\n    const tooltipHandlers = createTooltip(self.current, addLabel, offset);\n    const updateBars = selection.selectAll(`rect.${className}`).data(data, (d) => d[fields.y]);\n\n    const enterBars = updateBars.enter().append('rect');\n    enterBars\n      .attr('class', `${className}`)\n      .attr('x', 0)\n      .attr('height', scaleRef.current.y.bandwidth())\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]));\n    enterBars\n      .on('mousemove', tooltipHandlers.mousemove)\n      .on('mouseleave', tooltipHandlers.mouseleave)\n      .on('click', (enterData) => {\n        const selected = enterBars.filter((d) => d === enterData);\n        const value = selected.data()[0].key;\n        const filter = props?.fields?.isList ? {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'has',\n          values: value,\n        } : {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: value,\n        };\n        props.filterAdded([filter]);\n      });\n\n    updateBars\n      .merge(enterBars)\n      .transition()\n      .duration(1000)\n      .attr('width', (d) => scaleRef.current.x(d[fields.x]))\n      .selectAll('.label')\n      .text((d) => d.key);\n    // update_bars\n\n    updateBars.exit().transition().duration(1000).attr('width', 0)\n      .remove();\n\n    return updateBars;\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      d3.select(self.current).selectAll('svg').remove('svg');\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n      hightRef.current = innerHeight;\n\n      // create svg\n      const svg = d3\n        .select(self.current)\n        .append('svg')\n        .attr('width', rect.width)\n        .attr('height', rect.height);\n      // create viewer\n      viewerRef.current = svg\n        .append('g')\n        .attr('transform', `translate(${margin.left},${margin.top})`);\n      //\n      const xScale = createXScale(fields.x, innerWidth);\n      const yScale = createYScale(fields.y, innerHeight);\n      scaleRef.current = { x: xScale, y: yScale };\n\n      viewerRef.current\n        .append('g')\n        .attr('transform', `translate(0,${innerHeight})`)\n        .call(d3.axisBottom(xScale).tickSize(-innerHeight));\n\n      drawBar(viewerRef.current, fullData, 'og');\n      createTextLabel();\n    }, 100);\n  }, [props.layout]);\n\n  useEffect(() => {\n    setTimeout(() => {\n      let data = [];\n      if (props.filters.length > 0) {\n        data = transform(props.filterData, props.fields.y, props.fields.isList);\n      } else {\n        data = fullData;\n      }\n      drawBar(viewerRef.current, data, 'ft');\n      createTextLabel();\n    }, 100);\n  }, [props.filters, props.filterData, props.layout]);\n\n  return <div id={props.id} ref={self} style={{ width: '100%', height: '100%' }} />;\n}\n\nexport default HorizontalBarChart;\n\nHorizontalBarChart.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  fields: PropTypes.shape({ y: PropTypes.string.isRequired, isList: PropTypes.bool }).isRequired,\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  filterData: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filters: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filterAdded: PropTypes.func.isRequired,\n  layout: PropTypes.shape({\n    width: PropTypes.number.isRequired,\n    currentCols: PropTypes.number.isRequired,\n  }).isRequired,\n};\n"]}