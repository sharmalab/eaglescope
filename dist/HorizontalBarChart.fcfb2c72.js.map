{"version":3,"sources":["components/VisualTools/Chart/HorizontalBarChart.js"],"names":["_react","_interopRequireWildcard","require","d3","_propTypes","_interopRequireDefault","_tooltip","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","transformList","data","f","map","Map","forEach","d","items","Array","isArray","from","key","value","transform","field","isList","arguments","length","undefined","collator","Intl","Collator","numeric","sensitivity","collSort","b","compare","nest","sortKeys","rollup","v","entries","HorizontalBarChart","props","margin","top","right","bottom","left","fields","y","x","fullData","self","useRef","scaleRef","hightRef","viewerRef","createLogXScale","width","maxValue","max","xScale","scaleLog","domain","range","createXScale","scaleLinear","createYScale","height","yScale","scaleBand","padding","formatTick","toLocaleString","createTextLabel","current","selectAll","remove","enter","append","attr","bandwidth","text","on","filter","id","title","operation","values","filterAdded","drawBar","selection","className","addLabel","concat","offset","tooltipHandlers","createTooltip","updateBars","enterBars","mousemove","mouseleave","enterData","_props$fields","selected","merge","transition","duration","exit","useEffect","setTimeout","select","rect","getBoundingClientRect","innerWidth","innerHeight","tickCount","svg","console","log","logScale","axisBottom","tickSize","tickValues","ticks","tickFormat","layout","filters","filterData","createElement","ref","style","_default","exports","propTypes","PropTypes","arrayOf","shape","isRequired","string","bool","func","number","currentCols"],"mappings":"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","file":"HorizontalBarChart.fcfb2c72.js","sourceRoot":"../source","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport createTooltip from '../../partials/tooltip';\n\nconst transformList = (data, f) => {\n  const map = new Map();\n  data.forEach((d) => {\n    const items = d[f];\n    if (Array.isArray(items)) {\n      items.forEach((i) => {\n        if (!map.has(i)) { map.set(i, 0); }\n        map.set(i, map.get(i) + 1);\n      });\n    } else {\n      if (!map.has(items)) { map.set(items, 0); }\n      map.set(items, map.get(items) + 1);\n    }\n  });\n  return Array.from(map).map((d) => ({ key: d[0], value: d[1] }));\n};\n\nconst transform = (data, field, isList = false) => {\n  if (isList) {\n    return transformList(data, field);\n  }\n  const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'base' });\n  function collSort(a,b){\n    return collator.compare(b,a);\n  }\n  return d3\n    .nest()\n    .key((d) => d[field])\n    .sortKeys(collSort)\n    .rollup((v) => v.length)\n    .entries(data);\n};\n\nfunction HorizontalBarChart(props) {\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 10,\n  };\n\n  const fields = { y: 'key', x: 'value' };\n  const fullData = transform(props.data, props.fields.y, props.fields.isList);\n  const self = useRef();\n  const scaleRef = useRef();\n  const hightRef = useRef();\n  const viewerRef = useRef();\n\n  const createLogXScale = (f, width) => {\n    const maxValue = d3.max(fullData, d => d[f]);\n    // for now, starting domain at 1 always.\n    const xScale = d3.scaleLog()\n      .domain([1, maxValue])\n      .range([0, width]);\n    return xScale;\n  };\n\n  const createXScale = (f, width) => {\n    const xScale = d3\n      .scaleLinear()\n      .domain([0, d3.max(fullData, (d) => d[f])])\n      .range([0, width]);\n    return xScale;\n  };\n\n\n  const createYScale = (f, height) => {\n    // set the ranges\n    const yScale = d3\n      .scaleBand()\n      .domain(fullData.map((d) => d[f]))\n      .range([height, 0])\n      .padding(0.1);\n    return yScale;\n  };\n\n  const formatTick = (d) => d.toLocaleString();\n  \n  const createTextLabel = () => {\n    viewerRef.current.selectAll('.label').remove();\n    viewerRef.current\n      .selectAll('.label')\n      .data(fullData, (d) => d[fields.y])\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', 5)\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]) + scaleRef.current.y.bandwidth() / 2 + 4)\n      .text((d) => d.key)\n      .on('click', x=>{\n        const filter = {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: x.key,\n        };\n        props.filterAdded([filter])\n      });\n  };\n\n  const drawBar = (selection, data, className = 'og') => {\n    const addLabel = (d) => `${d.key}: ${d.value}`;\n    const offset = {\n      x: 30,\n      y: 10,\n    };\n    const tooltipHandlers = createTooltip(self.current, addLabel, offset);\n    const updateBars = selection.selectAll(`rect.${className}`).data(data, (d) => d[fields.y]);\n\n    const enterBars = updateBars.enter().append('rect');\n    enterBars\n      .attr('class', `${className}`)\n      .attr('x', 0)\n      .attr('height', scaleRef.current.y.bandwidth())\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]));\n    enterBars\n      .on('mousemove', tooltipHandlers.mousemove)\n      .on('mouseleave', tooltipHandlers.mouseleave)\n      .on('click', (enterData) => {\n        const selected = enterBars.filter((d) => d === enterData);\n        const value = selected.data()[0].key;\n        const filter = props?.fields?.isList ? {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'has',\n          values: value,\n        } : {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: value,\n        };\n        props.filterAdded([filter]);\n      });\n\n    updateBars\n      .merge(enterBars)\n      .transition()\n      .duration(1000)\n      .attr('width', (d) => scaleRef.current.x(d[fields.x]))\n      .selectAll('.label')\n      .text((d) => d.key);\n    // update_bars\n\n    updateBars.exit().transition().duration(1000).attr('width', 0)\n      .remove();\n\n    return updateBars;\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      d3.select(self.current).selectAll('svg').remove('svg');\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n      hightRef.current = innerHeight;\n      let tickCount = 4;\n\n      // create svg\n      const svg = d3\n        .select(self.current)\n        .append('svg')\n        .attr('width', rect.width)\n        .attr('height', rect.height);\n      // create viewer\n      viewerRef.current = svg\n        .append('g')\n        .attr('transform', `translate(${margin.left},${margin.top})`);\n      //\n      let xScale = createXScale(fields.x, innerWidth);\n      console.log(props)\n      if (props.logScale){\n        xScale = createLogXScale(fields.x, innerWidth);\n        tickCount = 2;\n      }\n      const yScale = createYScale(fields.y, innerHeight);\n      scaleRef.current = { x: xScale, y: yScale };\n\n      viewerRef.current\n        .append('g')\n        .attr('transform', `translate(0,${innerHeight})`)\n        .call(d3.axisBottom(xScale)\n          .tickSize(-innerHeight)\n          .tickValues(xScale.ticks(tickCount))\n          .tickFormat(formatTick));\n\n      drawBar(viewerRef.current, fullData, 'og');\n      createTextLabel();\n    }, 100);\n  }, [props.layout]);\n\n  useEffect(() => {\n    setTimeout(() => {\n      let data = [];\n      if (props.filters.length > 0) {\n        data = transform(props.filterData, props.fields.y, props.fields.isList);\n      } else {\n        data = fullData;\n      }\n      drawBar(viewerRef.current, data, 'ft');\n      createTextLabel();\n    }, 100);\n  }, [props.filters, props.filterData, props.layout]);\n\n  return <div id={props.id} ref={self} style={{ width: '100%', height: '100%' }} />;\n}\n\nexport default HorizontalBarChart;\n\nHorizontalBarChart.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  fields: PropTypes.shape({ y: PropTypes.string.isRequired, isList: PropTypes.bool }).isRequired,\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  filterData: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filters: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filterAdded: PropTypes.func.isRequired,\n  logScale: PropTypes.bool,\n  layout: PropTypes.shape({\n    width: PropTypes.number.isRequired,\n    currentCols: PropTypes.number.isRequired,\n  }).isRequired,\n};\n"]}