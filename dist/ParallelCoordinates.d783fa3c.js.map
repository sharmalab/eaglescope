{"version":3,"sources":["components/VisualTools/Chart/ParallelCoordinates.js"],"names":["_react","_interopRequireWildcard","require","d3","_propTypes","_interopRequireDefault","_utils","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","ParallelCoordinates","props","self","useRef","foregroundRef","backgroundRef","dimensions","fields","y","scales","x","scalePoint","margin","path","d","ctx","beginPath","forEach","p","moveTo","current","lineTo","stroke","brush","event","selection","field","filter","target","_ref","x1","x0","filterAdded","id","title","operation","values","numFixed","invert","useEffect","setTimeout","select","selectAll","remove","rect","getBoundingClientRect","innerWidth","width","innerHeight","height","append","attr","style","concat","node","getContext","strokeStyle","svg","domain","range","scaleLinear","extent","data","g","enter","each","axisLeft","text","brushY","on","layout","filterData","clearRect","filters","length","includes","createElement","ref","_default","exports","propTypes","PropTypes","string","isRequired","arrayOf","shape","func","number","currentCols"],"mappings":"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","file":"ParallelCoordinates.d783fa3c.js","sourceRoot":"../source","sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport { numFixed } from '../../../common/utils';\n\nfunction ParallelCoordinates(props) {\n  const self = useRef();\n  const foregroundRef = useRef();\n  const backgroundRef = useRef();\n  const dimensions = props.fields.y;\n  const scales = useRef({\n    x: d3.scalePoint(),\n    y: {},\n  });\n  const margin = {\n    top: 25,\n    right: 40,\n    bottom: 20,\n    left: 40,\n  };\n\n  function path(d, ctx) {\n    ctx.beginPath();\n    dimensions.forEach((p, i) => {\n      if (i === 0) {\n        ctx.moveTo(scales.current.x(p), scales.current.y[p](d[p]));\n      } else {\n        ctx.lineTo(scales.current.x(p), scales.current.y[p](d[p]));\n      }\n    });\n    ctx.stroke();\n  }\n\n  function brush() {\n    if (!d3.event.selection) return;\n    const field = dimensions.filter((d) => scales.current.y[d].brush === d3.event.target)[0];\n    const [x1, x0] = [d3.event.selection[0], d3.event.selection[1]];\n    props.filterAdded([\n      {\n        id: props.id,\n        title: props.title,\n        field,\n        operation: 'range',\n        values: [\n          numFixed(scales.current.y[field].invert(x0)),\n          numFixed(scales.current.y[field].invert(x1)),\n        ],\n      },\n    ]);\n  }\n\n  useEffect(() => {\n    setTimeout(() => {\n      d3.select(self.current).selectAll('canvas').remove('canvas');\n      d3.select(self.current).selectAll('svg').remove('svg');\n\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n\n      backgroundRef.current = d3\n        .select(self.current)\n        .append('canvas')\n        .attr('width', innerWidth)\n        .attr('height', innerHeight)\n        .style('transform', `translate(${margin.left}px,${margin.top}px)`);\n\n      foregroundRef.current = d3\n        .select(self.current)\n        .append('canvas')\n        .attr('width', innerWidth)\n        .attr('height', innerHeight)\n        .style('transform', `translate(${margin.left}px,${margin.top - innerHeight - 5}px)`);\n\n      backgroundRef.current = backgroundRef.current.node().getContext('2d');\n      foregroundRef.current = foregroundRef.current.node().getContext('2d');\n\n      foregroundRef.current.strokeStyle = 'rgba(0,100,160,0.24)';\n      backgroundRef.current.strokeStyle = 'rgba(0,0,0,0.1)';\n\n      const svg = d3\n        .select(self.current)\n        .append('svg')\n        .attr('width', rect.width)\n        .attr('height', rect.height)\n        .style('transform', `translate(${0}px,${-2 * innerHeight - margin.top / 2}px)`)\n        .append('g')\n        .style('transform', `translate(${margin.left}px,${margin.top}px)`);\n\n      scales.current.x.domain(dimensions);\n      scales.current.x.range([0, innerWidth], 1);\n\n      dimensions.forEach((d) => {\n        scales.current.y[d] = d3\n          .scaleLinear()\n          .domain(d3.extent(props.data, (p) => +p[d]))\n          .range([innerHeight, 0]);\n      });\n\n      const g = svg\n        .selectAll('.dimension')\n        .data(dimensions)\n        .enter()\n        .append('g')\n        .attr('class', 'dimension')\n        .attr('transform', (d) => `translate(${scales.current.x(d)})`);\n\n      // Add an axis and title.\n      g.append('g')\n        .attr('class', 'axis')\n        .each(function addAxis(d) {\n          d3.select(this).call(d3.axisLeft(scales.current.y[d]));\n        })\n        .append('text')\n        .style('text-anchor', 'middle')\n        .attr('y', -9)\n        .text((d) => d);\n\n      g.append('g')\n        .attr('class', 'brush')\n        .each(function addBrush(d) {\n          d3.select(this).call(\n            (scales.current.y[d].brush = d3\n              .brushY()\n              .extent([\n                [-10, 0],\n                [10, innerHeight],\n              ])\n              .on('end', brush)),\n          );\n        })\n        .selectAll('rect')\n        .attr('x', -8)\n        .attr('width', 16);\n    }, 100);\n  }, [props.layout]);\n\n  useEffect(() => {\n    setTimeout(() => {\n      if (!props.filterData) return;\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n\n      // Render selected lines\n      foregroundRef.current.clearRect(0, 0, innerWidth + 1, innerHeight + 1);\n      backgroundRef.current.clearRect(0, 0, innerWidth + 1, innerHeight + 1);\n      if (props.filters.length === 0) {\n        props.data.forEach((d) => {\n          path(d, foregroundRef.current);\n        });\n      } else {\n        props.data.forEach((d) => {\n          if (props.filterData.includes(d)) {\n            path(d, foregroundRef.current);\n          } else {\n            path(d, backgroundRef.current);\n          }\n        });\n      }\n    }, 100);\n  }, [props.filters, props.filterData, props.layout]);\n\n  return <div id={props.id} ref={self} style={{ width: '100%', height: '100%' }} />;\n}\n\nexport default ParallelCoordinates;\n\nParallelCoordinates.propTypes = {\n  title: PropTypes.string.isRequired,\n  data: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filterData: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  fields: PropTypes.shape({\n    y: PropTypes.arrayOf(PropTypes.string).isRequired,\n  }).isRequired,\n  id: PropTypes.string.isRequired,\n  filters: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filterAdded: PropTypes.func.isRequired,\n  layout: PropTypes.shape({\n    width: PropTypes.number.isRequired,\n    currentCols: PropTypes.number.isRequired,\n  }).isRequired,\n};\n"]}