parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"fxbF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=o(require("react")),e=o(require("d3")),r=n(require("prop-types"));function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(a=function(t){return t?r:e})(t)}function o(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=a(e);if(r&&r.has(t))return r.get(t);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var u=o?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=t[i]}return n.default=t,r&&r.set(t,n),n}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t){return s(t)||c(t)||l(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function c(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function s(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,v(n.key),n)}}function m(t,e,r){return e&&y(t.prototype,e),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function v(t){var e=h(t,"string");return"symbol"===i(e)?e:String(e)}function h(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}function b(t,e){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=k();return function(){var r,n=j(t);if(e){var a=j(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return x(this,r)}}function x(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return O(t)}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function S(t){return void 0===t||null==t||"string"==typeof t&&"na"===t.toLowerCase()}var _=exports.default=function(r){g(a,t.PureComponent);var n=w(a);function a(e){var r;return d(this,a),(r=n.call(this,e)).self=t.default.createRef(),r.maxTime=Number.NEGATIVE_INFINITY,r.state={margin:{top:35,right:20,bottom:45,left:45}},r.props.filter?r.state.data=r.transform(r.props.data.filter(function(t){return t[r.props.filter.field]===r.props.filter.value}),r.props.fields):r.state.data=r.transform(r.props.data,r.props.fields),r}return m(a,[{key:"componentDidMount",value:function(){var t=this;setTimeout(function(){var r=t.self.current.getBoundingClientRect(),n=r.width-t.state.margin.left-t.state.margin.right,a=r.height-t.state.margin.top-t.state.margin.bottom,o=e.select(t.self.current).append("svg").attr("width",r.width).attr("height",r.height),i=o.append("g").attr("transform","translate(".concat(t.state.margin.left,",").concat(t.state.margin.top,")"));t.xScale=e.scaleLinear().domain([0,t.maxTime]).range([0,n]),t.yScale=e.scaleLinear().domain([0,1]).range([a,0]),t.color=e.scaleOrdinal().domain(t.state.data.map(function(t){return t.key})).range(e.quantize(function(t){return e.interpolateSpectral(t)},t.state.data.length)),i.append("g").attr("transform","translate(0,".concat(a,")")).call(e.axisBottom(t.xScale).ticks(4)).append("text").attr("y",30).attr("x",n/2).attr("fill","black").attr("font-size",13).text("Time ".concat(t.props.fields.time.unit?"(".concat(t.props.fields.time.unit,")"):"")),i.append("g").call(e.axisLeft(t.yScale).ticks(4)).append("text").attr("y",-30).attr("x",-a/3).attr("fill","black").attr("font-size",13).attr("transform","rotate(-90)").text("Survival Probability"),t.state.data.forEach(function(e){return t.drawKMCurve(i,e)});var u=o.append("g").attr("class","legend").attr("transform","translate(".concat(t.state.margin.left+n/2,",0)")).selectAll("g").data(t.state.data).enter().append("g").attr("transform",function(t,e){return"translate(".concat(100*e,",").concat(15,")")});u.append("rect").style("fill",function(e){return t.color(e.key)}).attr("x",0).attr("y",0).attr("width",10).attr("height",10),u.append("text").style("font-family","Georgia").style("font-size","13px").attr("x",17.5).attr("y",10).text(function(t){return t.key});var f=0;u.attr("transform",function(){var t=f;return f+=this.getBBox().width+10,"translate(".concat(t,",").concat(10,")")})},500)}},{key:"transform",value:function(t,r){var n=r.eventValue,a=r.censoredValue,o=r.group.field,i=r.time.field,f=r.event.field,l=t.filter(function(t){return"stage_x/NR"!==t.collapsed_stage&&!S(t[i])&&!S(t[f])&&!S(t[o])});this.maxTime=Math.max.apply(Math,u(l.map(function(t){return t[i]})));var c=e.nest().key(function(t){return t[o]}).entries(l),s=[];return c.forEach(function(t){var r=t.key,o=t.values.length,u=e.nest().key(function(t){return+t[i]}).sortKeys(function(t,e){return+t-+e}).rollup(function(t){return{event:t.filter(function(t){return t[f]===n}).length,censor:t.filter(function(t){return t[f]===a}).length}}).entries(t.values),l=1,c=[];u.forEach(function(t){var e=+t.key,r=t.value.event,n=t.value.censor;if(!(e<0)){if(r>0){l*=1-r/o;c.push({p:l,currentTime:e,censored:!1})}if(n>0){c.push({p:l,currentTime:e,censored:!0})}o-=r+n}}),s.push({key:r,points:c})}),s}},{key:"drawLine",value:function(t,r,n){var a=this,o=e.line().curve(e.curveStepAfter).x(function(t){return a.xScale(t.time)}).y(function(t){return a.yScale(t.p)});t.append("path").datum(r).attr("class","line").style("stroke",n).attr("d",o),r.forEach(function(e){if(e.censored){var r=[{p:e.p-.015,time:e.time},{p:e.p+.015,time:e.time}];t.append("path").datum(r).attr("class","mark").style("stroke",n).attr("d",o)}})}},{key:"drawKMCurve",value:function(t,e){this.drawLine(t,e.points,this.color(e.key))}},{key:"render",value:function(){return t.default.createElement("div",{id:this.props.id,ref:this.self,style:{width:"100%",height:"100%"}})}}]),a}();_.propTypes={data:r.default.arrayOf(r.default.shape({})).isRequired,fields:r.default.shape({x:r.default.string.isRequired,time:r.default.shape()}).isRequired,filter:r.default.shape({field:r.default.string,value:r.default.string}),id:r.default.string.isRequired},_.defaultProps={filter:{}};
},{"react":"n8MK","d3":"UzF0","prop-types":"D9Od"}]},{},[], null)
//# sourceMappingURL=KMCurve.528ee624.js.map