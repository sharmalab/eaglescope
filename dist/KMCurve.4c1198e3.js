function t(t){return t&&t.__esModule?t.default:t}var e=globalThis.parcelRequire94c2;(0,e.register)("3qdiD",function(a,r){Object.defineProperty(a.exports,"__esModule",{value:!0,configurable:!0}),Object.defineProperty(a.exports,"default",{get:()=>p,set:void 0,enumerable:!0,configurable:!0});var s=e("ayMG0"),i=e("acw62"),l=e("9NlP8"),n=e("c9Z8w");function o(t){return void 0===t||null==t||"string"==typeof t&&"na"===t.toLowerCase()}class p extends i.PureComponent{constructor(e){super(e),this.self=t(i).createRef(),this.maxTime=Number.NEGATIVE_INFINITY,this.state={margin:{top:35,right:20,bottom:45,left:45}},this.props.filter?this.state.data=this.transform(this.props.data.filter(t=>t[this.props.filter.field]===this.props.filter.value),this.props.fields):this.state.data=this.transform(this.props.data,this.props.fields)}componentDidMount(){setTimeout(()=>{let t=this.self.current.getBoundingClientRect(),e=t.width-this.state.margin.left-this.state.margin.right,a=t.height-this.state.margin.top-this.state.margin.bottom,r=l.select(this.self.current).append("svg").attr("width",t.width).attr("height",t.height),s=r.append("g").attr("transform",`translate(${this.state.margin.left},${this.state.margin.top})`);this.xScale=l.scaleLinear().domain([0,this.maxTime]).range([0,e]),this.yScale=l.scaleLinear().domain([0,1]).range([a,0]),this.color=l.scaleOrdinal().domain(this.state.data.map(t=>t.key)).range(l.quantize(t=>l.interpolateSpectral(t),this.state.data.length)),s.append("g").attr("transform",`translate(0,${a})`).call(l.axisBottom(this.xScale).ticks(4)).append("text").attr("y",30).attr("x",e/2).attr("fill","black").attr("font-size",13).text(`Time ${this.props.fields.time.unit?`(${this.props.fields.time.unit})`:""}`),s.append("g").call(l.axisLeft(this.yScale).ticks(4)).append("text").attr("y",-30).attr("x",-a/3).attr("fill","black").attr("font-size",13).attr("transform","rotate(-90)").text("Survival Probability"),this.state.data.forEach(t=>this.drawKMCurve(s,t));let i=t=>t.getBBox().width,n=r.append("g").attr("class","legend").attr("transform",`translate(${this.state.margin.left+e/2},0)`).selectAll("g").data(this.state.data).enter().append("g").attr("transform",(t,e)=>`translate(${100*e},15)`);n.append("rect").style("fill",t=>this.color(t.key)).attr("x",0).attr("y",0).attr("width",10).attr("height",10),n.append("text").style("font-family","Georgia").style("font-size","13px").attr("x",17.5).attr("y",10).text(t=>t.key);let o=0;n.attr("transform",function(){let t=o;return o+=i(this)+10,`translate(${t},10)`})},500)}transform(t,e){let{eventValue:a}=e,{censoredValue:r}=e,s=e.group.field,i=e.time.field,n=e.event.field,p=t.filter(t=>"stage_x/NR"!==t.collapsed_stage&&!o(t[i])&&!o(t[n])&&!o(t[s]));this.maxTime=Math.max(...p.map(t=>t[i]));let h=l.nest().key(t=>t[s]).entries(p),d=[];return h.forEach(t=>{let{key:e}=t,s=t.values.length,o=l.nest().key(t=>+t[i]).sortKeys((t,e)=>+t-+e).rollup(t=>({event:t.filter(t=>t[n]===a).length,censor:t.filter(t=>t[n]===r).length})).entries(t.values),p=1,h=[];o.forEach(t=>{let e=+t.key,a=t.value.event,r=t.value.censor;e<0||(a>0&&(p*=1-a/s,h.push({p:p,currentTime:e,censored:!1})),r>0&&h.push({p:p,currentTime:e,censored:!0}),s-=a+r)}),d.push({key:e,points:h})}),d}drawLine(t,e,a){let r=l.line().curve(l.curveStepAfter).x(t=>this.xScale(t.time)).y(t=>this.yScale(t.p));t.append("path").datum(e).attr("class","line").style("stroke",a).attr("d",r),e.forEach(e=>{if(e.censored){let s=[{p:e.p-.015,time:e.time},{p:e.p+.015,time:e.time}];t.append("path").datum(s).attr("class","mark").style("stroke",a).attr("d",r)}})}drawKMCurve(t,e){this.drawLine(t,e.points,this.color(e.key))}render(){return(0,s.jsx)("div",{id:this.props.id,ref:this.self,role:"figure",style:{width:"100%",height:"100%"}})}}p.propTypes={data:t(n).arrayOf(t(n).shape({})).isRequired,fields:t(n).shape({x:t(n).string.isRequired,time:t(n).shape()}).isRequired,filter:t(n).shape({field:t(n).string,value:t(n).string}),id:t(n).string.isRequired},p.defaultProps={filter:{}}});
//# sourceMappingURL=KMCurve.4c1198e3.js.map
