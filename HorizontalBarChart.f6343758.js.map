{"version":3,"sources":["components/VisualTools/Chart/HorizontalBarChart.js"],"names":["_react","_interopRequireWildcard","require","d3","_propTypes","_interopRequireDefault","_tooltip","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","transformList","data","f","map","Map","forEach","d","items","Array","isArray","from","key","value","transform","field","arguments","length","undefined","nest","sortKeys","ascending","rollup","v","entries","HorizontalBarChart","props","margin","fields","fullData","y","isList","self","useRef","scaleRef","hightRef","viewerRef","createTextLabel","current","selectAll","remove","enter","append","attr","bandwidth","text","on","x","filter","id","title","operation","values","filterAdded","drawBar","selection","className","tooltipHandlers","createTooltip","concat","updateBars","enterBars","mousemove","mouseleave","enterData","_props$fields","merge","transition","duration","exit","useEffect","setTimeout","select","rect","getBoundingClientRect","innerWidth","width","innerHeight","height","svg","xScale","scaleLinear","domain","max","range","yScale","scaleBand","padding","createYScale","axisBottom","tickSize","layout","filters","filterData","createElement","ref","role","style","_default","exports","propTypes","PropTypes","arrayOf","shape","isRequired","string","bool","func","number","currentCols"],"mappings":";AA6MC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA7MD,IAAAA,EAAAC,EAAAC,QAAA,UACAC,EAAAF,EAAAC,QAAA,OACAE,EAAAC,EAAAH,QAAA,eACAI,EAAAD,EAAAH,QAAA,2BAAmD,SAAAG,EAAAE,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,GAAA,SAAAG,EAAAH,GAAAI,GAAAA,mBAAAA,QAAAC,OAAAA,KAAAA,IAAAA,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,QAAAD,OAAAA,EAAAA,SAAAH,GAAAA,OAAAA,EAAAM,EAAAD,IAAAL,GAAA,SAAAN,EAAAM,EAAAK,GAAAA,IAAAA,GAAAL,GAAAA,EAAAC,WAAAD,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAE,MAAAA,CAAAA,QAAAF,GAAAM,IAAAA,EAAAH,EAAAE,GAAAC,GAAAA,GAAAA,EAAAC,IAAAP,GAAAM,OAAAA,EAAAE,IAAAR,GAAAS,IAAAA,EAAAC,CAAAA,UAAAC,MAAAA,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAAC,IAAAA,IAAAA,KAAAf,EAAAe,GAAAA,YAAAA,GAAAC,GAAAA,eAAAC,KAAAjB,EAAAe,GAAAG,CAAAA,IAAAA,EAAAP,EAAAC,OAAAE,yBAAAd,EAAAe,GAAAG,KAAAA,IAAAA,EAAAV,KAAAU,EAAAC,KAAAP,OAAAC,eAAAJ,EAAAM,EAAAG,GAAAT,EAAAM,GAAAf,EAAAe,GAAAN,OAAAA,EAAAP,QAAAF,EAAAM,GAAAA,EAAAa,IAAAnB,EAAAS,GAAAA,EAEnD,IAAMW,EAAgB,SAACC,EAAMC,GAC3B,IAAMC,EAAM,IAAIC,IAahB,OAZAH,EAAKI,QAAQ,SAACC,GACZ,IAAMC,EAAQD,EAAEJ,GACZM,MAAMC,QAAQF,GAChBA,EAAMF,QAAQ,SAACP,GACRK,EAAIhB,IAAIW,IAAMK,EAAIJ,IAAID,EAAG,GAC9BK,EAAIJ,IAAID,EAAGK,EAAIf,IAAIU,GAAK,MAGrBK,EAAIhB,IAAIoB,IAAUJ,EAAIJ,IAAIQ,EAAO,GACtCJ,EAAIJ,IAAIQ,EAAOJ,EAAIf,IAAImB,GAAS,MAG7BC,MAAME,KAAKP,GAAKA,IAAI,SAACG,GAAC,MAAM,CAAEK,IAAKL,EAAE,GAAIM,MAAON,EAAE,OAGrDO,EAAY,SAACZ,EAAMa,GACvB,OADoCC,UAAAC,OAAAD,QAAAE,IAAAF,UAAAE,IAAAF,UAAG,GAE9Bf,EAAcC,EAAMa,GAEtBtC,EACJ0C,OACAP,IAAI,SAACL,GAAC,OAAKA,EAAEQ,KACbK,SAAS3C,EAAG4C,WACZC,OAAO,SAACC,GAAC,OAAKA,EAAEN,SAChBO,QAAQtB,IAGb,SAASuB,EAAmBC,GAC1B,IAAMC,EACC,GADDA,EAEG,GAFHA,EAGI,GAHJA,EAIE,GAGFC,EAAc,MAAdA,EAAwB,QACxBC,EAAWf,EAAUY,EAAMxB,KAAMwB,EAAME,OAAOE,EAAGJ,EAAME,OAAOG,QAC9DC,GAAO,EAAAC,EAAM,UACbC,GAAW,EAAAD,EAAM,UACjBE,GAAW,EAAAF,EAAM,UACjBG,GAAY,EAAAH,EAAM,UAoBlBI,EAAkB,WACtBD,EAAUE,QAAQC,UAAU,UAAUC,SACtCJ,EAAUE,QACPC,UAAU,UACVrC,KAAK2B,EAAU,SAACtB,GAAC,OAAKA,EAAEqB,KACxBa,QACAC,OAAO,QACPC,KAAK,QAAS,SACdA,KAAK,IAAK,GACVA,KAAK,IAAK,SAACpC,GAAC,OAAK2B,EAASI,QAAQR,EAAEvB,EAAEqB,IAAaM,EAASI,QAAQR,EAAEc,YAAc,EAAI,IACxFC,KAAK,SAACtC,GAAC,OAAKA,EAAEK,MACdkC,GAAG,QAAS,SAACC,GACZ,IAAMC,EAAS,CACbC,GAAIvB,EAAMuB,GACVC,MAAOxB,EAAMwB,MACbnC,MAAOW,EAAME,OAAOE,EACpBqB,UAAW,KACXC,OAAQL,EAAEnC,KAEZc,EAAM2B,YAAY,CAACL,OAInBM,EAAU,SAACC,EAAWrD,GAA2B,IAArBsD,EAASxC,UAAAC,OAAAD,QAAAE,IAAAF,UAAAE,GAAAF,UAAG,GAAA,KAMtCyC,GAAkB,EAAAC,EAAa,SAAC1B,EAAKM,QAL1B,SAAC/B,GAAC,MAAAoD,GAAAA,OAAQpD,EAAEK,IAAG+C,MAAAA,OAAKpD,EAAEM,QACxB,CACbkC,EAAG,GACHjB,EAAG,KAGC8B,EAAaL,EAAUhB,UAASoB,QAAAA,OAASH,IAAatD,KAAKA,EAAM,SAACK,GAAC,OAAKA,EAAEqB,KAE1EiC,EAAYD,EAAWnB,QAAQC,OAAO,QAwC5C,OAvCAmB,EACGlB,KAAK,QAAOgB,GAAAA,OAAKH,IACjBb,KAAK,IAAK,GACVA,KAAK,SAAUT,EAASI,QAAQR,EAAEc,aAClCD,KAAK,IAAK,SAACpC,GAAC,OAAK2B,EAASI,QAAQR,EAAEvB,EAAEqB,MACzCiC,EACGf,GAAG,YAAaW,EAAgBK,WAChChB,GAAG,aAAcW,EAAgBM,YACjCjB,GAAG,QAAS,SAACkB,GAAc,IAAAC,EAEpBpD,EADWgD,EAAUb,OAAO,SAACzC,GAAC,OAAKA,IAAMyD,IACxB9D,OAAO,GAAGU,IAC3BoC,EAAStB,MAAAA,GAAauC,QAARA,EAALvC,EAAOE,cAAPqC,IAAaA,GAAbA,EAAelC,OAAS,CACrCkB,GAAIvB,EAAMuB,GACVC,MAAOxB,EAAMwB,MACbnC,MAAOW,EAAME,OAAOE,EACpBqB,UAAW,MACXC,OAAQvC,GACN,CACFoC,GAAIvB,EAAMuB,GACVC,MAAOxB,EAAMwB,MACbnC,MAAOW,EAAME,OAAOE,EACpBqB,UAAW,KACXC,OAAQvC,GAEVa,EAAM2B,YAAY,CAACL,MAGvBY,EACGM,MAAML,GACNM,aACAC,SAAS,KACTzB,KAAK,QAAS,SAACpC,GAAC,OAAK2B,EAASI,QAAQS,EAAExC,EAAEqB,MAC1CW,UAAU,UACVM,KAAK,SAACtC,GAAC,OAAKA,EAAEK,MAGjBgD,EAAWS,OAAOF,aAAaC,SAAS,KAAMzB,KAAK,QAAS,GACzDH,SAEIoB,GAiDT,OA9CA,EAAAU,EAAS,WAAC,WACRC,WAAW,WACT9F,EAAG+F,OAAOxC,EAAKM,SAASC,UAAU,OAAOC,OAAO,OAChD,IAAMiC,EAAOzC,EAAKM,QAAQoC,wBACpBC,EAAaF,EAAKG,MAAQjD,EAAcA,EACxCkD,EAAcJ,EAAKK,OAASnD,EAAaA,EAC/CQ,EAASG,QAAUuC,EAGnB,IAAME,EAAMtG,EACT+F,OAAOxC,EAAKM,SACZI,OAAO,OACPC,KAAK,QAAS8B,EAAKG,OACnBjC,KAAK,SAAU8B,EAAKK,QAEvB1C,EAAUE,QAAUyC,EACjBrC,OAAO,KACPC,KAAK,YAAWgB,aAAAA,OAAehC,EAAWgC,KAAAA,OAAIhC,EAAa,MAE9D,IAhHkBxB,EAAGyE,EAgHfI,GAhHY7E,EAgHUyB,EAhHPgD,EAgHiBD,EA/GzBlG,EACZwG,cACAC,OAAO,CAAC,EAAGzG,EAAG0G,IAAItD,EAAU,SAACtB,GAAC,OAAKA,EAAEJ,OACrCiF,MAAM,CAAC,EAAGR,KA6GLS,EAzGW,SAAClF,EAAG2E,GAOvB,OALerG,EACZ6G,YACAJ,OAAOrD,EAASzB,IAAI,SAACG,GAAC,OAAKA,EAAEJ,MAC7BiF,MAAM,CAACN,EAAQ,IACfS,QAAQ,IAmGMC,CAAa5D,EAAUiD,GACtC3C,EAASI,QAAU,CAAES,EAAGiC,EAAQlD,EAAGuD,GAEnCjD,EAAUE,QACPI,OAAO,KACPC,KAAK,YAAWgB,eAAAA,OAAiBkB,EAAc,MAC/C/E,KAAKrB,EAAGgH,WAAWT,GAAQU,UAAUb,IAExCvB,EAAQlB,EAAUE,QAAST,EAAU,MACrCQ,KACC,MACF,CAACX,EAAMiE,UAEV,EAAArB,EAAS,WAAC,WACRC,WAAW,WACT,IAAIrE,EAAO,GAETA,EADEwB,EAAMkE,QAAQ3E,OAAS,EAClBH,EAAUY,EAAMmE,WAAYnE,EAAME,OAAOE,EAAGJ,EAAME,OAAOG,QAEzDF,EAETyB,EAAQlB,EAAUE,QAASpC,EAAM,MACjCmC,KACC,MACF,CAACX,EAAMkE,QAASlE,EAAMmE,WAAYnE,EAAMiE,SAEpCrH,EAAAS,QAAA+G,cAAA,MAAA,CAAK7C,GAAIvB,EAAMuB,GAAI8C,IAAK/D,EAAMgE,KAAK,SAASC,MAAO,CAAErB,MAAO,OAAQE,OAAQ,UACpF,IAAAoB,EAAAC,QAAApH,QAEc0C,EAEfA,EAAmB2E,UAAY,CAC7BlG,KAAMmG,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WAC7C5E,OAAQyE,EAAS,QAACE,MAAM,CAAEzE,EAAGuE,EAAS,QAACI,OAAOD,WAAYzE,OAAQsE,EAAS,QAACK,OAAQF,WACpFvD,GAAIoD,EAAS,QAACI,OAAOD,WACrBtD,MAAOmD,EAAS,QAACI,OAAOD,WACxBX,WAAYQ,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WACnDZ,QAASS,EAAS,QAACC,QAAQD,EAAS,QAACE,MAAM,KAAKC,WAChDnD,YAAagD,EAAS,QAACM,KAAKH,WAC5Bb,OAAQU,EAAS,QAACE,MAAM,CACtB3B,MAAOyB,EAAS,QAACO,OAAOJ,WACxBK,YAAaR,EAAS,QAACO,OAAOJ,aAC7BA","file":"HorizontalBarChart.f6343758.js","sourceRoot":"../source","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport createTooltip from '../../partials/tooltip';\n\nconst transformList = (data, f) => {\n  const map = new Map();\n  data.forEach((d) => {\n    const items = d[f];\n    if (Array.isArray(items)) {\n      items.forEach((i) => {\n        if (!map.has(i)) { map.set(i, 0); }\n        map.set(i, map.get(i) + 1);\n      });\n    } else {\n      if (!map.has(items)) { map.set(items, 0); }\n      map.set(items, map.get(items) + 1);\n    }\n  });\n  return Array.from(map).map((d) => ({ key: d[0], value: d[1] }));\n};\n\nconst transform = (data, field, isList = false) => {\n  if (isList) {\n    return transformList(data, field);\n  }\n  return d3\n    .nest()\n    .key((d) => d[field])\n    .sortKeys(d3.ascending)\n    .rollup((v) => v.length)\n    .entries(data);\n};\n\nfunction HorizontalBarChart(props) {\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 10,\n  };\n\n  const fields = { y: 'key', x: 'value' };\n  const fullData = transform(props.data, props.fields.y, props.fields.isList);\n  const self = useRef();\n  const scaleRef = useRef();\n  const hightRef = useRef();\n  const viewerRef = useRef();\n\n  const createXScale = (f, width) => {\n    const xScale = d3\n      .scaleLinear()\n      .domain([0, d3.max(fullData, (d) => d[f])])\n      .range([0, width]);\n    return xScale;\n  };\n\n  const createYScale = (f, height) => {\n    // set the ranges\n    const yScale = d3\n      .scaleBand()\n      .domain(fullData.map((d) => d[f]))\n      .range([height, 0])\n      .padding(0.1);\n    return yScale;\n  };\n\n  const createTextLabel = () => {\n    viewerRef.current.selectAll('.label').remove();\n    viewerRef.current\n      .selectAll('.label')\n      .data(fullData, (d) => d[fields.y])\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', 5)\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]) + scaleRef.current.y.bandwidth() / 2 + 4)\n      .text((d) => d.key)\n      .on('click', (x) => {\n        const filter = {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: x.key,\n        };\n        props.filterAdded([filter]);\n      });\n  };\n\n  const drawBar = (selection, data, className = 'og') => {\n    const addLabel = (d) => `${d.key}: ${d.value}`;\n    const offset = {\n      x: 30,\n      y: 10,\n    };\n    const tooltipHandlers = createTooltip(self.current, addLabel, offset);\n    const updateBars = selection.selectAll(`rect.${className}`).data(data, (d) => d[fields.y]);\n\n    const enterBars = updateBars.enter().append('rect');\n    enterBars\n      .attr('class', `${className}`)\n      .attr('x', 0)\n      .attr('height', scaleRef.current.y.bandwidth())\n      .attr('y', (d) => scaleRef.current.y(d[fields.y]));\n    enterBars\n      .on('mousemove', tooltipHandlers.mousemove)\n      .on('mouseleave', tooltipHandlers.mouseleave)\n      .on('click', (enterData) => {\n        const selected = enterBars.filter((d) => d === enterData);\n        const value = selected.data()[0].key;\n        const filter = props?.fields?.isList ? {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'has',\n          values: value,\n        } : {\n          id: props.id,\n          title: props.title,\n          field: props.fields.y,\n          operation: 'eq',\n          values: value,\n        };\n        props.filterAdded([filter]);\n      });\n\n    updateBars\n      .merge(enterBars)\n      .transition()\n      .duration(1000)\n      .attr('width', (d) => scaleRef.current.x(d[fields.x]))\n      .selectAll('.label')\n      .text((d) => d.key);\n    // update_bars\n\n    updateBars.exit().transition().duration(1000).attr('width', 0)\n      .remove();\n\n    return updateBars;\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      d3.select(self.current).selectAll('svg').remove('svg');\n      const rect = self.current.getBoundingClientRect();\n      const innerWidth = rect.width - margin.left - margin.right;\n      const innerHeight = rect.height - margin.top - margin.bottom;\n      hightRef.current = innerHeight;\n\n      // create svg\n      const svg = d3\n        .select(self.current)\n        .append('svg')\n        .attr('width', rect.width)\n        .attr('height', rect.height);\n      // create viewer\n      viewerRef.current = svg\n        .append('g')\n        .attr('transform', `translate(${margin.left},${margin.top})`);\n      //\n      const xScale = createXScale(fields.x, innerWidth);\n      const yScale = createYScale(fields.y, innerHeight);\n      scaleRef.current = { x: xScale, y: yScale };\n\n      viewerRef.current\n        .append('g')\n        .attr('transform', `translate(0,${innerHeight})`)\n        .call(d3.axisBottom(xScale).tickSize(-innerHeight));\n\n      drawBar(viewerRef.current, fullData, 'og');\n      createTextLabel();\n    }, 100);\n  }, [props.layout]);\n\n  useEffect(() => {\n    setTimeout(() => {\n      let data = [];\n      if (props.filters.length > 0) {\n        data = transform(props.filterData, props.fields.y, props.fields.isList);\n      } else {\n        data = fullData;\n      }\n      drawBar(viewerRef.current, data, 'ft');\n      createTextLabel();\n    }, 100);\n  }, [props.filters, props.filterData, props.layout]);\n\n  return <div id={props.id} ref={self} role=\"figure\" style={{ width: '100%', height: '100%' }} />;\n}\n\nexport default HorizontalBarChart;\n\nHorizontalBarChart.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  fields: PropTypes.shape({ y: PropTypes.string.isRequired, isList: PropTypes.bool }).isRequired,\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  filterData: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filters: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n  filterAdded: PropTypes.func.isRequired,\n  layout: PropTypes.shape({\n    width: PropTypes.number.isRequired,\n    currentCols: PropTypes.number.isRequired,\n  }).isRequired,\n};\n"]}